# Progress Artifact Template
# Copy to: .mycelium/missions/<mission-id>/progress.yaml
# 
# This YAML structure is the single source of truth for mission progress.
# All agents read from and write to this file.

# -------------------------------------------------------------------
# CURRENT AGENT (tracks which agent runs next)
# Valid values: scientist | implementer | verifier | maintainer | "" (empty = complete)
# Updated by each agent at the end of their run via self-sequencing
# -------------------------------------------------------------------
current_agent: ""

# -------------------------------------------------------------------
# MISSION CONTEXT (filled by Mission Organizer or Scientist)
# -------------------------------------------------------------------
mission_context:
  # Short name for the development phase (e.g., "Infrastructure", "Feature Development")
  phase: "Workflow Enhancement"
  
  # What this mission aims to accomplish (1-2 sentences)
  objective: "Integrate testing as a core part of the mycelium agent workflow. Tests should be lightweight for small missions and mandatory for anything that should persist, with the 4 agents maintaining their existing flow."
  
  # Specific tasks, files, or areas this mission covers
  # Use array format for multiple items
  scope:
    - "Update Scientist agent to include test planning in their output"
    - "Update Implementer agent to write tests alongside implementation"
    - "Update Verifier agent to run tests as part of the verification process"
    - "Update PROGRESS_TEMPLATE.yaml to include test-related fields"
    - "Update CONTRACT.md if needed to reflect testing requirements"
    - "Define lightweight vs mandatory testing criteria"
  
  # Limitations, requirements, or rules that must be followed
  constraints:
    - "Maintain the existing 4-agent flow (scientist → implementer → verifier → maintainer)"
    - "Keep testing lightweight for small/exploratory missions"
    - "Make testing mandatory only for persistent/production-ready work"
    - "Do not break existing mission workflows"
    - "Tests should complement existing verification, not replace it"
  
  # What is explicitly out of scope for this mission
  non_goals:
    - "Adding new agents specifically for testing"
    - "Changing the fundamental agent handoff mechanism"
    - "Implementing specific test frameworks (leave that to individual missions)"
    - "Retroactively adding tests to completed missions"

# -------------------------------------------------------------------
# SCIENTIST PLAN (filled by Scientist agent)
# -------------------------------------------------------------------
scientist_plan:
  # Path to this progress artifact (for reference)
  progress_artifact_path: ".mycelium/missions/agent-testing-integration/progress.yaml"
  
  # Checklist mode determines verification rigor
  # Valid values: None | SMOKE | EXPERIMENT
  checklist_mode: "SMOKE"
  
  # Definition of Done - clear PASS/FAIL criteria
  # Each item should be independently verifiable
  definition_of_done:
    - description: "PROGRESS_TEMPLATE.yaml has a `test_mode` field (NONE | SMOKE | FULL) in mission_context"
      status: "pending"
    - description: "PROGRESS_TEMPLATE.yaml has a `test_plan` section in scientist_plan with test criteria fields"
      status: "pending"
    - description: "PROGRESS_TEMPLATE.yaml has `tests_written` and `tests_run` fields in implementer_log"
      status: "pending"
    - description: "PROGRESS_TEMPLATE.yaml has `test_results` section in verifier_report"
      status: "pending"
    - description: "scientist.md includes guidance for planning tests based on test_mode"
      status: "pending"
    - description: "implementer.md includes guidance for writing tests when test_mode != NONE"
      status: "pending"
    - description: "verifier.md includes guidance for running tests as part of verification"
      status: "pending"
    - description: "CONTRACT.md has a Testing section defining NONE/SMOKE/FULL criteria"
      status: "pending"
  
  # Ordered steps to accomplish the mission
  # Each step should have a clear expected outcome
  plan_steps:
    - step: 1
      description: "Add testing fields to PROGRESS_TEMPLATE.yaml"
      expected_outcome: |
        - mission_context gains `test_mode: \"NONE\"` field (NONE | SMOKE | FULL)
        - scientist_plan gains `test_plan` subsection with: test_strategy, acceptance_tests array
        - implementer_log gains: tests_written (array), tests_run (array with command/result)
        - verifier_report gains: test_results (array with test_name/status/output)
    - step: 2
      description: "Update CONTRACT.md with Testing section"
      expected_outcome: |
        New ## Testing section that defines:
        - NONE: No tests required (exploratory/throwaway missions)
        - SMOKE: Basic sanity tests that verify core functionality works
        - FULL: Comprehensive tests required for production-ready/persistent code
        - Default is NONE; scientist upgrades based on mission persistence
    - step: 3
      description: "Update scientist.md to include test planning responsibility"
      expected_outcome: |
        - Add bullet: "If test_mode != NONE, fill test_plan with test strategy and acceptance tests"
        - Add guidance: "Set test_mode to SMOKE for features that should work reliably, FULL for production code"
    - step: 4
      description: "Update implementer.md to include test writing responsibility"
      expected_outcome: |
        - Add bullet: "If test_mode != NONE, write tests according to test_plan before marking DoD items complete"
        - Add: "Log tests in tests_written and tests_run fields"
    - step: 5
      description: "Update verifier.md to include test running responsibility"
      expected_outcome: |
        - Add to verification steps: "If test_mode != NONE, run all tests and record in test_results"
        - Add: "FAIL if any tests fail and test_mode is SMOKE or FULL"
  
  # Potential issues or unknowns that could affect the mission
  risks_unknowns:
    - "Existing missions in progress may need migration (mitigated: new fields have empty defaults)"
    - "Test framework choice varies by project (mitigated: we specify WHAT to test, not HOW)"
    - "FULL test mode may be too heavyweight for some projects (mitigated: scientist chooses mode)"
  
  # Conditions that should cause the agent to stop and ask the user
  stop_conditions:
    - "If unclear whether a mission type should default to SMOKE vs NONE"
    - "If the test_plan structure doesn't fit a particular use case"
    - "If changes would break existing mission workflows"

# -------------------------------------------------------------------
# IMPLEMENTER LOG (appended by Implementer agent, one entry per iteration)
# -------------------------------------------------------------------
implementer_log:
  - iteration: 1
    # What changed (5 bullets max)
    changes:
      - "Added test_mode field (NONE|SMOKE|FULL) to mission_context in PROGRESS_TEMPLATE.yaml"
      - "Added test_plan section with test_strategy and acceptance_tests to scientist_plan"
      - "Added tests_written and tests_run fields to implementer_log"
      - "Added test_results section to verifier_report"
      - "Updated all 4 agent files with testing responsibilities"
    # Files created, modified, or deleted
    files_touched:
      - ".mycelium/missions/PROGRESS_TEMPLATE.yaml"
      - ".mycelium/CONTRACT.md"
      - ".mycelium/agents/mission/scientist.md"
      - ".mycelium/agents/mission/implementer.md"
      - ".mycelium/agents/mission/verifier.md"
    # Exact commands run
    commands_run:
      - command: "N/A - documentation/template changes only"
        result: "N/A"
    # Paths to any outputs produced
    outputs_produced:
      - "N/A - no runtime outputs"
    # Remaining issues or TODO items
    issues_todo:
      - "None - all plan steps completed"

# -------------------------------------------------------------------
# VERIFIER REPORT (appended by Verifier agent, one entry per iteration)
# -------------------------------------------------------------------
verifier_report:
  - iteration: 1
    # DoD item checks with PASS/FAIL and evidence
    dod_checks:
      - item: "PROGRESS_TEMPLATE.yaml has a `test_mode` field (NONE | SMOKE | FULL) in mission_context"
        status: "PASS"
        evidence: "Lines 37-42: test_mode field exists with NONE default and NONE/SMOKE/FULL options documented"
      - item: "PROGRESS_TEMPLATE.yaml has a `test_plan` section in scientist_plan with test criteria fields"
        status: "PASS"
        evidence: "Lines 76-83: test_plan section with test_strategy and acceptance_tests array exists"
      - item: "PROGRESS_TEMPLATE.yaml has `tests_written` and `tests_run` fields in implementer_log"
        status: "PASS"
        evidence: "Lines 106-112: tests_written array and tests_run array with command/result fields exist"
      - item: "PROGRESS_TEMPLATE.yaml has `test_results` section in verifier_report"
        status: "PASS"
        evidence: "Lines 134-138: test_results section with test_name/status/output fields exists"
      - item: "scientist.md includes guidance for planning tests based on test_mode"
        status: "PASS"
        evidence: "Lines 25-30: Steps 4-5 cover filling test_plan and upgrading test_mode"
      - item: "implementer.md includes guidance for writing tests when test_mode != NONE"
        status: "PASS"
        evidence: "Lines 22-24, 32-33: Step 4 covers writing tests, step 6 includes tests_written/tests_run logging"
      - item: "verifier.md includes guidance for running tests as part of verification"
        status: "PASS"
        evidence: "Lines 18-21: Step 5 covers running tests and recording in test_results with FAIL criteria"
      - item: "CONTRACT.md has a Testing section defining NONE/SMOKE/FULL criteria"
        status: "PASS"
        evidence: "Lines 60-74: Testing section with table defining all three modes and guidelines"
    # Commands re-run to verify
    commands_rerun:
      - command: "N/A - documentation/template changes only, verified by file inspection"
        result: "All files contain expected content"
    # Required fixes - blockers that must be addressed
    required_fixes: []
    # Suggestions that are nice-to-have but not blocking
    optional_improvements:
      - "Consider adding a MIGRATION.md for existing missions if needed in future"
    # MANDATORY: exactly one of these values
    # "FAIL — rerun Implementer" or "PASS — ready for Maintainer"
    overall_status: "PASS — ready for Maintainer"
    # Canonical command (for PASS)
    canonical_command: "N/A - workflow documentation changes, no runtime command"
    # Expected outputs (for PASS)
    expected_outputs:
      - ".mycelium/missions/PROGRESS_TEMPLATE.yaml (updated template)"
      - ".mycelium/CONTRACT.md (with Testing section)"
      - ".mycelium/agents/mission/scientist.md (with test planning)"
      - ".mycelium/agents/mission/implementer.md (with test writing)"
      - ".mycelium/agents/mission/verifier.md (with test running)"

# -------------------------------------------------------------------
# MAINTAINER NOTES (filled by Maintainer agent)
# -------------------------------------------------------------------
maintainer_notes:
  # What the maintainer changed
  changes:
    - "No code refactoring needed - implementation is clean documentation/template changes"
    - "Verified all new fields have sensible defaults (test_mode: NONE)"
    - "Confirmed backward compatibility - new fields are optional with empty defaults"
  # Confirmation that behavior is unchanged
  behavior_unchanged: true
  # Why it improves maintainability
  maintainability_notes:
    - "Testing integration is opt-in via test_mode, preserving lightweight workflow for exploratory missions"
    - "Clear separation of concerns: scientist plans, implementer writes, verifier runs tests"
    - "Three-tier system (NONE/SMOKE/FULL) provides flexibility without complexity"
  # If any commands or paths changed, document here
  updated_commands: []
  updated_paths: []

# -------------------------------------------------------------------
# MAINTAINER SUMMARY (filled by Maintainer agent)
# -------------------------------------------------------------------
maintainer_summary:
  # What exists now (1-5 bullets)
  what_exists:
    - "PROGRESS_TEMPLATE.yaml now includes test_mode field in mission_context (NONE | SMOKE | FULL)"
    - "scientist_plan has test_plan subsection for test strategy and acceptance tests"
    - "implementer_log has tests_written and tests_run fields for logging test activity"
    - "verifier_report has test_results section for recording test outcomes"
    - "All 4 mission agents updated with testing responsibilities"
  # The canonical command to run
  canonical_command: "N/A - workflow documentation changes. Use `.mycelium/bin/mycelium next <mission-path>` to run agents as usual."
  # Expected output paths
  expected_outputs:
    - ".mycelium/missions/PROGRESS_TEMPLATE.yaml"
    - ".mycelium/CONTRACT.md"
    - ".mycelium/agents/mission/scientist.md"
    - ".mycelium/agents/mission/implementer.md"
    - ".mycelium/agents/mission/verifier.md"
  # Any quirks or limitations
  notes:
    - "Default test_mode is NONE - scientist must explicitly upgrade for missions requiring tests"
    - "Test framework choice is left to individual projects/missions"
    - "Existing missions in progress are unaffected - new fields have empty defaults"

# -------------------------------------------------------------------
# COMMIT MESSAGE (generated by Maintainer agent)
# -------------------------------------------------------------------
commit_message:
  type: "feat"
  subject: "integrate testing into mycelium agent workflow"
  body: |
    Add testing support to the 4-agent mission workflow:
    
    - Add test_mode field (NONE|SMOKE|FULL) to mission_context
    - Add test_plan section to scientist_plan for test strategy
    - Add tests_written/tests_run fields to implementer_log
    - Add test_results section to verifier_report
    - Update scientist.md with test planning responsibilities
    - Update implementer.md with test writing responsibilities
    - Update verifier.md with test running responsibilities
    - Add Testing section to CONTRACT.md defining mode criteria
    
    Testing is opt-in (default NONE) to keep workflow lightweight
    for exploratory missions while enabling rigor for production code.

