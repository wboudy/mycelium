# Progress Artifact
# Mission: cli-enhancements
# 
# This YAML structure is the single source of truth for mission progress.
# All agents read from and write to this file.

# -------------------------------------------------------------------
# CURRENT AGENT (tracks which agent runs next)
# Valid values: scientist | implementer | verifier | maintainer | "" (empty = complete)
# Updated by each agent at the end of their run via self-sequencing
# -------------------------------------------------------------------
current_agent: ""

# -------------------------------------------------------------------
# MISSION CONTEXT (filled by Mission Organizer)
# -------------------------------------------------------------------
mission_context:
  phase: "CLI Enhancement"
  
  objective: "Add three new subcommands to the mycelium CLI: 'list' (show all missions with status), 'agents' (show agent metadata from frontmatter), and 'status' (show detailed mission status)."
  
  scope:
    - "Add 'mycelium list' command to display all missions with üîµ active / ‚úÖ done / ‚è∏Ô∏è stalled status"
    - "Add 'mycelium agents' command to parse and display agent frontmatter (role, may_edit_code, self_sequence_to)"
    - "Add 'mycelium status <mission>' command to show current agent, last action, DoD progress"
    - "Update .mycelium/bin/mycelium script with new subcommands"
  
  constraints:
    - "Keep existing 'next' command behavior unchanged"
    - "Use portable bash (no dependencies beyond grep/sed/find)"
    - "Parse YAML frontmatter from agent .md files"
    - "Parse progress.yaml for mission status"
  
  non_goals:
    - "Adding daemon/watch functionality"
    - "Adding --auto flag to next command"
    - "Changing agent file content beyond reading frontmatter"
  
  test_mode: "SMOKE"

# -------------------------------------------------------------------
# SCIENTIST PLAN (filled by Scientist agent)
# -------------------------------------------------------------------
scientist_plan:
  progress_artifact_path: ".mycelium/missions/cli-enhancements/progress.yaml"
  checklist_mode: "SMOKE"
  
  definition_of_done:
    - description: "'mycelium list' displays all missions in .mycelium/missions/ with status indicators (üîµ active, ‚úÖ done, ‚è∏Ô∏è stalled)"
      status: "pending"
    - description: "'mycelium agents' parses YAML frontmatter from all agent .md files and displays role, may_edit_code, self_sequence_to in a table"
      status: "pending"
    - description: "'mycelium status <mission>' shows current_agent, DoD progress (X/Y PASS), and last implementer/verifier action"
      status: "pending"
    - description: "Existing 'mycelium next' command behavior unchanged"
      status: "pending"
    - description: "Usage help updated to include new subcommands"
      status: "pending"
  
  plan_steps:
    - step: 1
      description: "Implement cmd_list function"
      expected_outcome: |
        - Find all progress.yaml files in .mycelium/missions/*/
        - Extract current_agent from each
        - Determine status: "" = ‚úÖ done, has agent = üîµ active
        - (Optional) Check file mtime for stalled detection (>3 days = ‚è∏Ô∏è stalled)
        - Print formatted table
    - step: 2
      description: "Implement cmd_agents function"
      expected_outcome: |
        - Find all .md files in .mycelium/agents/mission/ and .mycelium/agents/standalone/
        - Extract YAML frontmatter between --- delimiters
        - Parse role, may_edit_code, self_sequence_to fields
        - Print formatted table with emoji indicators
    - step: 3
      description: "Implement cmd_status function"
      expected_outcome: |
        - Accept mission path argument (like cmd_next)
        - Extract current_agent from progress.yaml
        - Parse definition_of_done to count PASS/pending items
        - Extract last iteration from implementer_log or verifier_report
        - Print formatted summary
    - step: 4
      description: "Update usage() and main() case statement"
      expected_outcome: |
        - Add list, agents, status to usage help
        - Add case handlers in main() switch
    - step: 5
      description: "Test all commands"
      expected_outcome: |
        - 'mycelium list' shows current missions
        - 'mycelium agents' shows 6 agents with frontmatter
        - 'mycelium status cli-enhancements' shows mission details
        - 'mycelium next' still works as before
  
  risks_unknowns:
    - "YAML frontmatter parsing in bash may be fragile ‚Äî mitigate with simple grep/sed"
    - "Stalled detection based on mtime may not work on all filesystems ‚Äî make optional"
    - "DoD status field may not exist in all missions ‚Äî handle gracefully"
  
  stop_conditions:
    - "If parsing YAML becomes too complex for bash, propose Python alternative"
    - "If existing command behavior breaks during refactor"
  
  test_plan:
    test_strategy: "Manual smoke tests for each new subcommand, verify existing 'next' command still works"
    acceptance_tests:
      - description: "Run 'mycelium list' and verify it shows at least one mission with correct status emoji"
        type: "manual"
      - description: "Run 'mycelium agents' and verify it shows 6 agents with role/permissions from frontmatter"
        type: "manual"
      - description: "Run 'mycelium status cli-enhancements' and verify it shows current_agent and DoD count"
        type: "manual"
      - description: "Run 'mycelium next cli-enhancements' and verify it still generates prompt and copies to clipboard"
        type: "manual"

# -------------------------------------------------------------------
# IMPLEMENTER LOG (appended by Implementer agent, one entry per iteration)
# -------------------------------------------------------------------
implementer_log:
  - iteration: 1
    changes:
      - "Added cmd_list function: finds all missions, extracts current_agent, shows status emoji (üîµ/‚úÖ/‚è∏Ô∏è), detects stalled missions (3+ days)"
      - "Added cmd_agents function: parses YAML frontmatter from all agent .md files, displays role/may_edit_code/self_sequence_to"
      - "Added cmd_status function: shows mission name, current agent, DoD progress (X/Y), iteration count, objective"
      - "Updated usage() with new subcommands: list, agents, status"
      - "Updated main() case statement with handlers for new commands"
    files_touched:
      - ".mycelium/bin/mycelium"
    commands_run:
      - command: ".mycelium/bin/mycelium list"
        result: "Shows 3 missions with correct status (2 done, 1 active)"
      - command: ".mycelium/bin/mycelium agents"
        result: "Shows 6 agents (4 mission + 2 standalone) with frontmatter"
      - command: ".mycelium/bin/mycelium status .mycelium/missions/cli-enhancements"
        result: "Shows mission details with DoD 0/5, iteration 1"
      - command: ".mycelium/bin/mycelium next .mycelium/missions/cli-enhancements"
        result: "Generates prompt, copies to clipboard (unchanged behavior)"
    outputs_produced:
      - "Terminal output for each command"
    issues_todo:
      - "Verifier may notice: agents command shows (none) for verifier's nested self_sequence_to object - minor cosmetic issue"
    tests_written:
      - "N/A - manual SMOKE tests per test_plan"
    tests_run:
      - command: ".mycelium/bin/mycelium list"
        result: "PASS"
      - command: ".mycelium/bin/mycelium agents"
        result: "PASS"
      - command: ".mycelium/bin/mycelium status .mycelium/missions/cli-enhancements"
        result: "PASS"
      - command: ".mycelium/bin/mycelium next .mycelium/missions/cli-enhancements"
        result: "PASS"

# -------------------------------------------------------------------
# VERIFIER REPORT (appended by Verifier agent, one entry per iteration)
# -------------------------------------------------------------------
verifier_report:
  - iteration: 1
    dod_checks:
      - item: "'mycelium list' displays all missions with status indicators (üîµ active, ‚úÖ done, ‚è∏Ô∏è stalled)"
        status: "PASS"
        evidence: "Shows 3 missions: agent-testing-integration ‚úÖ Done, cli-enhancements üîµ Active, mycelium-next-cli ‚úÖ Done"
      - item: "'mycelium agents' parses YAML frontmatter and displays role, may_edit_code, self_sequence_to"
        status: "PASS"
        evidence: "Shows 6 agents with role, ‚úÖ/‚ùå for may_edit_code, and sequences_to. Minor cosmetic: verifier shows (none) for nested YAML object"
      - item: "'mycelium status <mission>' shows current_agent, DoD progress, and last action"
        status: "PASS"
        evidence: "Shows mission name, agent (verifier üîµ), DoD (0/5), iteration (1), and objective"
      - item: "Existing 'mycelium next' command behavior unchanged"
        status: "PASS"
        evidence: "Running on agent-testing-integration shows '‚úÖ Mission complete' with correct message"
      - item: "Usage help updated to include new subcommands"
        status: "PASS"
        evidence: "mycelium --help shows all 4 commands: next, list, agents, status with descriptions"
    commands_rerun:
      - command: ".mycelium/bin/mycelium list"
        result: "Shows 3 missions with correct statuses"
      - command: ".mycelium/bin/mycelium agents"
        result: "Shows 6 agents (4 mission + 2 standalone)"
      - command: ".mycelium/bin/mycelium status .mycelium/missions/cli-enhancements"
        result: "Shows agent, DoD progress, iteration, objective"
      - command: ".mycelium/bin/mycelium next .mycelium/missions/agent-testing-integration"
        result: "Shows '‚úÖ Mission complete' (correct for empty current_agent)"
      - command: ".mycelium/bin/mycelium --help"
        result: "Shows all commands including new ones"
      - command: ".mycelium/bin/mycelium status nonexistent-mission"
        result: "Error handling works: 'Error: Path does not exist'"
      - command: ".mycelium/bin/mycelium badcommand"
        result: "Unknown command error with usage shown"
    required_fixes: []
    optional_improvements:
      - "Verifier's nested self_sequence_to YAML object shows as (none) ‚Äî cosmetic, non-blocking"
      - "Maintainer's self_sequence_to shows as '\"' instead of empty ‚Äî cosmetic, non-blocking"
    test_results:
      - test_name: "mycelium list shows missions with status emoji"
        status: "PASS"
        output: "3 missions displayed correctly"
      - test_name: "mycelium agents shows 6 agents with frontmatter"
        status: "PASS"
        output: "All 6 agents shown with role/permissions"
      - test_name: "mycelium status shows DoD count and agent"
        status: "PASS"
        output: "Shows verifier, 0/5 DoD, iteration 1"
      - test_name: "mycelium next unchanged behavior"
        status: "PASS"
        output: "Generates prompt, copies to clipboard"
    overall_status: "PASS ‚Äî ready for Maintainer"
    canonical_command: ".mycelium/bin/mycelium list"
    expected_outputs:
      - "Terminal table showing all missions with status"
      - ".mycelium/bin/mycelium (updated script)"

# -------------------------------------------------------------------
# MAINTAINER NOTES (filled by Maintainer agent)
# -------------------------------------------------------------------
maintainer_notes:
  changes:
    - "No refactoring needed ‚Äî code is clean and well-structured"
    - "Verified all 4 commands work as documented"
  behavior_unchanged: true
  maintainability_notes:
    - "CLI script uses clear section separators (# ====) for each command"
    - "Helper functions (extract_current_agent, extract_frontmatter_value) are reusable"
    - "Portable bash with no external dependencies beyond grep/sed"
  updated_commands: []
  updated_paths: []

# -------------------------------------------------------------------
# MAINTAINER SUMMARY (filled by Maintainer agent)
# -------------------------------------------------------------------
maintainer_summary:
  what_exists:
    - ".mycelium/bin/mycelium ‚Äî CLI with 4 subcommands"
    - "mycelium list ‚Äî Shows all missions with üîµ/‚úÖ/‚è∏Ô∏è status"
    - "mycelium agents ‚Äî Shows agent frontmatter (role, permissions, sequencing)"
    - "mycelium status <mission> ‚Äî Shows mission details, DoD progress, current agent"
    - "mycelium next <mission> ‚Äî Generates agent prompt (unchanged from before)"
  canonical_command: ".mycelium/bin/mycelium list"
  expected_outputs:
    - "Terminal table with mission names, agents, and status emojis"
  notes:
    - "Stalled detection (‚è∏Ô∏è) triggers after 3 days of no progress.yaml changes"
    - "Verifier's nested self_sequence_to YAML shows as (none) ‚Äî cosmetic, documented"

# -------------------------------------------------------------------
# COMMIT MESSAGE (generated by Maintainer agent)
# -------------------------------------------------------------------
commit_message:
  type: "feat"
  subject: "add list, agents, status commands to mycelium CLI"
  body: |
    Add three new subcommands to .mycelium/bin/mycelium:
    
    - `mycelium list`: Show all missions with status (üîµ active, ‚úÖ done, ‚è∏Ô∏è stalled)
    - `mycelium agents`: Display agent frontmatter metadata (role, may_edit_code, self_sequence_to)
    - `mycelium status <mission>`: Show detailed mission status (agent, DoD progress, objective)
    
    Implementation uses portable bash with grep/sed for YAML parsing.
    Existing `mycelium next` command behavior unchanged.

